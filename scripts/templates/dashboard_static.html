<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CodeQL Devin Fixer &ndash; Dashboard</title>
<style>
  :root {
    --bg: #0d1117; --surface: #161b22; --surface-hover: #1c2128;
    --border: #30363d; --text: #e6edf3; --text-muted: #8b949e;
    --accent: #58a6ff; --green: #3fb950; --red: #f85149;
    --yellow: #d29922; --purple: #bc8cff; --orange: #f0883e;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
    background: var(--bg); color: var(--text); padding: 32px 24px;
    max-width: 1200px; margin: 0 auto; line-height: 1.5;
  }

  /* ---- Header ---- */
  .header { margin-bottom: 32px; }
  .header h1 { font-size: 26px; font-weight: 700; margin-bottom: 4px; }
  .header h1 span { color: var(--accent); }
  .header .meta { color: var(--text-muted); font-size: 13px; display: flex; flex-wrap: wrap; gap: 16px; }
  .header .meta a { color: var(--accent); text-decoration: none; }
  .header .meta a:hover { text-decoration: underline; }

  /* ---- Metric cards ---- */
  .cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 14px; margin-bottom: 36px;
  }
  .card {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 10px; padding: 18px 16px;
  }
  .card .label {
    color: var(--text-muted); font-size: 11px; text-transform: uppercase;
    letter-spacing: 0.6px; margin-bottom: 6px;
  }
  .card .value { font-size: 34px; font-weight: 700; }
  .card .sub { color: var(--text-muted); font-size: 12px; margin-top: 2px; }
  .green  { color: var(--green); }
  .red    { color: var(--red); }
  .yellow { color: var(--yellow); }
  .accent { color: var(--accent); }
  .purple { color: var(--purple); }
  .orange { color: var(--orange); }

  /* ---- Section headings ---- */
  h2 {
    font-size: 17px; font-weight: 600; margin: 28px 0 12px;
    padding-bottom: 6px; border-bottom: 1px solid var(--border);
  }

  /* ---- Bar charts (CSS-only) ---- */
  .bar-chart { margin-bottom: 28px; }
  .bar-row {
    display: flex; align-items: center; margin-bottom: 6px; font-size: 13px;
  }
  .bar-row .bar-label {
    width: 130px; flex-shrink: 0; color: var(--text-muted);
    text-transform: capitalize;
  }
  .bar-row .bar-track {
    flex: 1; height: 18px; background: var(--surface); border-radius: 4px;
    overflow: hidden; border: 1px solid var(--border);
  }
  .bar-row .bar-fill {
    height: 100%; border-radius: 4px 0 0 4px; transition: width .3s;
  }
  .bar-row .bar-count {
    width: 50px; text-align: right; flex-shrink: 0; font-weight: 600;
    font-size: 13px;
  }

  /* ---- Tables ---- */
  table {
    width: 100%; border-collapse: collapse; margin-bottom: 32px;
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 10px; overflow: hidden;
  }
  th {
    background: var(--surface-hover); text-align: left; padding: 10px 14px;
    font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px;
    color: var(--text-muted); border-bottom: 1px solid var(--border);
  }
  td {
    padding: 10px 14px; border-bottom: 1px solid var(--border); font-size: 13px;
  }
  tr:last-child td { border-bottom: none; }
  tr:hover td { background: rgba(88,166,255,0.04); }
  a { color: var(--accent); text-decoration: none; }
  a:hover { text-decoration: underline; }

  /* ---- Badges ---- */
  .badge {
    display: inline-block; padding: 2px 10px; border-radius: 12px;
    font-size: 11px; font-weight: 600; letter-spacing: 0.3px;
  }
  .badge.merged  { background: rgba(63,185,80,0.15); color: var(--green); }
  .badge.open    { background: rgba(88,166,255,0.15); color: var(--accent); }
  .badge.closed  { background: rgba(248,81,73,0.15); color: var(--red); }
  .badge.created { background: rgba(188,140,255,0.15); color: var(--purple); }
  .badge.dry-run { background: rgba(139,148,158,0.15); color: var(--text-muted); }

  .empty {
    color: var(--text-muted); text-align: center; padding: 40px;
    font-size: 14px;
  }

  /* ---- Footer ---- */
  .footer {
    margin-top: 48px; padding-top: 16px; border-top: 1px solid var(--border);
    color: var(--text-muted); font-size: 12px; text-align: center;
  }
  .footer a { color: var(--accent); }
</style>
</head>
<body>

<!-- Header -->
<div class="header">
  <h1>CodeQL Devin Fixer <span>Dashboard</span></h1>
  <div class="meta">
    <span>Repository: <a href="https://github.com/{{ repo_name }}" target="_blank">{{ repo_name }}</a></span>
    <span>Generated: {{ generated_at }}</span>
    <span>Runs analysed: {{ total_runs }}</span>
  </div>
</div>

<!-- Metric cards -->
<div class="cards">
  <div class="card">
    <div class="label">Action Runs</div>
    <div class="value accent">{{ total_runs }}</div>
    <div class="sub">workflow dispatches</div>
  </div>
  <div class="card">
    <div class="label">Issues Found</div>
    <div class="value yellow">{{ total_issues }}</div>
    <div class="sub">across all runs</div>
  </div>
  <div class="card">
    <div class="label">Devin Sessions</div>
    <div class="value purple">{{ total_sessions }}</div>
    <div class="sub">AI agents dispatched</div>
  </div>
  <div class="card">
    <div class="label">PRs Created</div>
    <div class="value accent">{{ total_prs }}</div>
    <div class="sub">fix pull requests</div>
  </div>
  <div class="card">
    <div class="label">PRs Merged</div>
    <div class="value green">{{ prs_merged }}</div>
    <div class="sub">{{ merge_rate }} merge rate</div>
  </div>
  <div class="card">
    <div class="label">PRs Open</div>
    <div class="value orange">{{ prs_open }}</div>
    <div class="sub">awaiting review</div>
  </div>
  <div class="card">
    <div class="label">PRs Closed</div>
    <div class="value red">{{ prs_closed }}</div>
    <div class="sub">closed without merge</div>
  </div>
</div>

<!-- Severity breakdown -->
<h2>Issues by Severity</h2>
{{ severity_bars|safe }}

<!-- Category breakdown -->
<h2>Issues by Category</h2>
{{ category_bars|safe }}

<!-- Run history -->
<h2>Run History</h2>
{{ runs_table|safe }}

<!-- Devin sessions -->
<h2>Devin Sessions</h2>
{{ sessions_table|safe }}

<!-- Pull requests -->
<h2>Pull Requests</h2>
{{ prs_table|safe }}

<div class="footer">
  Powered by <a href="https://github.com/{{ action_repo }}" target="_blank">CodeQL Devin Fixer</a>
  &middot; Data refreshed every action run
</div>

</body>
</html>
